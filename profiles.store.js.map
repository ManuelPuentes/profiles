{"version":3,"file":"profiles.store.js","sourceRoot":"","sources":["../src/profiles.store.ts"],"names":[],"mappings":";AAAA,OAAO,EAAU,aAAa,EAAE,MAAM,4BAA4B,CAAC;AAEnE,OAAO,EACL,UAAU,EACV,cAAc,EACd,MAAM,EACN,WAAW,EACX,QAAQ,GACT,MAAM,MAAM,CAAC;AAId,MAAM,OAAO,aAAa;IAIxB,YAAsB,eAAgC;QAAhC,oBAAe,GAAf,eAAe,CAAiB;QAF/C,aAAQ,GAAwB,EAAE,CAAC;QAGxC,cAAc,CAAC,IAAI,CAAC,CAAC;IACvB,CAAC;IAED,IAAI,aAAa;QACf,OAAO,aAAa,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;IACvD,CAAC;IAGD,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC3C,CAAC;IAGD,IAAI,aAAa;QACf,OAAO,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,aAAa,EAAE,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC;YACtE,aAAa;YACb,OAAO;SACR,CAAC,CAAC,CAAC;IACN,CAAC;IAGM,KAAK,CAAC,gBAAgB;QAC3B,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,CAAC;QAEhE,WAAW,CAAC,GAAG,EAAE;YACf,KAAK,MAAM,YAAY,IAAI,WAAW,EAAE;gBACtC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,aAAa,CAAC,GAAG,YAAY,CAAC,OAAO,CAAC;aAClE;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAGM,KAAK,CAAC,cAAc;QACzB,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,CAAC;QAE5D,WAAW,CAAC,GAAG,EAAE;YACf,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,SAAS,CAAC,OAAO,CAAC;QACxD,CAAC,CAAC,CAAC;IACL,CAAC;IAGM,KAAK,CAAC,cAAc,CAAC,cAAsB;QAChD,MAAM,gBAAgB,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,cAAc,CAChE,cAAc,CACf,CAAC;QAEF,WAAW,CAAC,GAAG,EAAE;YACf,KAAK,MAAM,EAAE,aAAa,EAAE,OAAO,EAAE,IAAI,gBAAgB,EAAE;gBACzD,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,GAAG,OAAO,CAAC;aACxC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAGM,KAAK,CAAC,aAAa,CAAC,OAAgB;QACzC,MAAM,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QAElD,WAAW,CAAC,GAAG,EAAE;YACf,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,OAAO,CAAC;QAC9C,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AAhEC;IADC,UAAU;+CAC+B;AAW1C;IADC,QAAQ;8CAGR;AAGD;IADC,QAAQ;kDAMR;AAGD;IADC,MAAM;qDASN;AAGD;IADC,MAAM;mDAON;AAGD;IADC,MAAM;mDAWN;AAGD;IADC,MAAM;kDAON","sourcesContent":["import { Hashed, serializeHash } from '@holochain-open-dev/common';\nimport { Dictionary } from '@holochain-open-dev/common/core-types';\nimport {\n  observable,\n  makeObservable,\n  action,\n  runInAction,\n  computed,\n} from 'mobx';\nimport { ProfilesService } from './profiles.service';\nimport { AgentProfile, Profile } from './types';\n\nexport class ProfilesStore {\n  @observable\n  public profiles: Dictionary<Profile> = {};\n\n  constructor(protected profilesService: ProfilesService) {\n    makeObservable(this);\n  }\n\n  get myAgentPubKey() {\n    return serializeHash(this.profilesService.cellId[1]);\n  }\n\n  @computed\n  get myProfile(): Profile | undefined {\n    return this.profiles[this.myAgentPubKey];\n  }\n\n  @computed\n  get knownProfiles(): Array<AgentProfile> {\n    return Object.entries(this.profiles).map(([agent_pub_key, profile]) => ({\n      agent_pub_key,\n      profile,\n    }));\n  }\n\n  @action\n  public async fetchAllProfiles() {\n    const allProfiles = await this.profilesService.getAllProfiles();\n\n    runInAction(() => {\n      for (const agentProfile of allProfiles) {\n        this.profiles[agentProfile.agent_pub_key] = agentProfile.profile;\n      }\n    });\n  }\n\n  @action\n  public async fetchMyProfile() {\n    const myProfile = await this.profilesService.getMyProfile();\n\n    runInAction(() => {\n      this.profiles[this.myAgentPubKey] = myProfile.profile;\n    });\n  }\n\n  @action\n  public async searchProfiles(nicknamePrefix: string) {\n    const searchedProfiles = await this.profilesService.searchProfiles(\n      nicknamePrefix\n    );\n\n    runInAction(() => {\n      for (const { agent_pub_key, profile } of searchedProfiles) {\n        this.profiles[agent_pub_key] = profile;\n      }\n    });\n  }\n\n  @action\n  public async createProfile(profile: Profile) {\n    await this.profilesService.createProfile(profile);\n\n    runInAction(() => {\n      this.profiles[this.myAgentPubKey] = profile;\n    });\n  }\n}\n"]}